---
title: "praktikr: Cumulative Practice Time in Domain Experts"
author: "Michael Großbach"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{praktikr}
  %\VignetteEngine{knitr::rmarkdown}
bibliography: /home/grossbach/files/_sonstiges/000literaturdb.bib
csl: /home/grossbach/files/_sonstiges/frontiers-in-neuroscience.csl  
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

```{r setup, message=FALSE}
library(dplyr)
library(ggplot2)
library(ggthemes)
library(kfigr)
library(knitr)
library(lubridate)
library(praktikr)
library(tidyr)
## ggplot2:
theme_set(theme_light(base_size = 10))
## knitr & kfigr:
knit_hooks$set(anchor = hook_anchor)
opts_knit$set(kfigr.link = TRUE,
              kfigr.prefix = TRUE)
options(knitr.kable.NA = "",
        rmarkdown.html_vignette.check_title = FALSE)
## Constants:
FIGREF <- "Fig." # type for pics and plots, figr()
TABREF <- "Tab." # type for tables, figr()
EQREF <- "Eq." # type for model equations, figr()
SRCREF <- "Src." # type for source code blocks, figr()
```

## Introduction

The $\text{R}$ package $\text{praktikr}$ contains functions to ease handling of subjective, and often sparse, deliberate practice time estimates, retrospectively collected from domain experts such as chess players [e.g., @Howard2011] and musicians [e.g., @Ioannou2018] (see @Hambrick2014 for a review of studies in either domain). Mean daily hours of deliberate practice are used to calculate cumulative practice hours someone has spent practice in their field of expertise. @Ericsson1993 and @Lehmann1998b basically suggested that practice makes perfect and that a cumulative 10.000 hours within 10 years make an expert. And, "[a]s Bengtsson et al. (2005) found, there is a high retest reliability of this method for different age groups (childhood: r.81; adolescence: r.86; adulthood: r.95)" [@Kopiez2009a]. While there certainly is a correlation between cumulative deliberate practice time and domain expertise **[citation needed; motor learning experiments?]**, it undoubtedly is only one factor in determining expertise (see, e.g. @Hambrick2014 for a critique of Ericsson's deliberate practice theory). But it is a variable that can be collected both rather easily and retrospectively. And because it is easy to collect, it is often used as a proxy for expertise.

The aim of this vignette is not to criticize the usage of practice time as a proxy for expertise, but rather to make researchers aware of potential pitfalls when collecting and analyzing practice time data, and to show how to ease handling of such data sets. The underlying rationale being that even if the measure is not undisputed, if used at all it should be measured and analyzed as accurately as possible.

## Installation

The package is as of yet not on CRAN (Comprehensive R Archive Network, a repository of $\text{R}$ packages; https://cran.r-project.org/), but can be installed from github by issuing the following commands at the $\text{R}$ console:

```{r, echo=TRUE, eval=FALSE}
if (!require("remotes")) {
  install.packages("remotes")
}
remotes::install_github("grossbach/praktikr")
```

This installs the package $\text{praktikr}$ into your personal $\text{R}$ directory. To be able to use it in $\text{R}$, the canonical way is to attach it to the current $\text{R}$ session:

```{r, echo=TRUE, eval=FALSE}
library(praktikr)
```

Further required libraries for this document are:

```{r, echo=TRUE, eval=FALSE}
library(dplyr)
library(ggplot2)
library(ggthemes)
library(tidyr)
```

## Practice Time Data

The included data set `practicetime` consists of artificial data, mirroring real data collected in the field.

***

`r figr("LoadDataSet", type = SRCREF)`. *Load data into current $\text{R}$ session environment.*

```{r LoadDataSet, echo=TRUE, anchor=SRCREF}
data("practicetime")
```

Meta data about the data set can be accessed by:

```{r, echo=TRUE, eval=FALSE}
?practicetime
```

It resembles real data sets obtained from students at a music conservatory. Those students are usually asked to provide retrospective estimates of the time they spent at their instrument during pre-defined age brackets. The actual question might be:

> On average, how many hours per day did you spend playing or rehearsing you instrument between the ages of between \<lower bound\>  and \<upper bound\>?

Subjects are reminded that they are asked for the mean hours, meaning they have to take the duration of the corresponding bracket into account.

***

`r figr("ShowDataSet", type = TABREF)`. *The first and the last six rows of the simulated data set. ID, subject ID; DOB, date-of-birth; 0-5, mean daily hours of deliberate practice in the ages 0 through 5 years; 6-8, mean daily hours of deliberate practice in the ages 6 through 8 years; 9-12, mean daily hours of deliberate practice in the ages 9 through 12 years; 13-16, mean daily hours of deliberate practice in the ages 13 through 16 years; 17-20, mean daily hours of deliberate practice in the ages 17 through 20 years; 21-25, mean daily hours of deliberate practice in the ages 21 through 25 years; 26-30, mean daily hours of deliberate practice in the ages 26 through 30 years.*

```{r ShowDataSet, anchor=TABREF}
kable(rbind(head(practicetime),
            tail(practicetime)))
```

For further ease of processing the data, it is convenient to coerce the ID column to a factor:

```{r, echo=TRUE}
practicetime %>% mutate(ID = factor(ID)) ->
  practicetime
```

To plot the amount of mean daily hours spent at the instrument for each age bracket and each individual, one can make use of $\text{praktikr}$'s own **plot_it()** function:

```{r RawData, echo=TRUE, anchor=FIGREF}
plot_it(practicetime, cols = "\\d{1,2}")
```

`r figr("RawData", type = FIGREF)`. *Mean daily deliberate practice hours plotted against age brackets. Each line represents one participant and connects the retrospectively collected mean daily hours per age bracket at the instrument.*

***

From `r figr("RawData")` we can infer that most participants started playing in the second age bracket. There is a trend visible suggesting that mean daily practice time correlates with age. Most subjects were in the second to last age bracket when the study commenced. Many students seem to have ceased intensive practice during their last age bracket.

This plot has several problems: (a) The lengths of the age brackets are uneven, tricking the onlooker into misjudging a participant's increase (or decrease) of mean daily practice hours over time. (b) Should the research question pertain to the amount of daily hours during particular age brackets, then this plot is an adequate illustration of the data (but see (c) below). Most of the time the researcher will be interested in practice time dynamics relative to some event---this might be the time of the study or a playing-related injury etc. (c) The seemingly decreasing number of hours during many students last bracket will be dealt with at a later stage (ch. [The Last Age Bracket]).

(a) To avoid the apparent isochrony of age brackets, the function `spread_brackets()` comes in handy:

```{r MakeBracketIsochronous, anchor=SRCREF}
iso_brackets <- spread_brackets(practicetime, cols = "\\d{1,2}")
```

```{r PlotIsoBrackets, anchor=FIGREF}
plot_it(iso_brackets, cols = paste(0:30), ID = "ID")
```

`r figr("PlotIsoBrackets", type = FIGREF)`. *The same data as in `r figr("RawData")`, but plotted against age in years, so that bracket duration becomes visible.*

***

(b)

## Potential Pitfalls

Looking at the data partially shown in `r figr("ShowDataSet")`, to obtain the cumulative deliberate practice time, one might be tempted to just multiply each participants' mean daily practice times (measured in hours) by 365 days per year, times the duration of the corresponding age bracket (measured in years), and then sum up all the products within a given participant. 

### The First Age Bracket

When one asks participants to retrospectively estimate their practice time in the past, it apparently is easier for people to name their average daily practice time during a pre-defined age bracket **[citation needed]** than on a yearly basis. Combined with people's date-of-birth and the date when they filled in the questionnaire, we can calculate their ages at the time of the study. Some participants in the above shown example data set started playing their main instrument at a very early age. They estimated their mean daily practice time in the first age bracket as, e.g. half an hour. The first age bracket in our data set entails the ages [0,5]. Assume participant A started playing at the age of 4 and, for simplicity, additionally assume that they started playing on the day they turned four. When filling out the questionnaire, this required them to average their practice time in the following year over the ages 0 through 5. An average of half an hour over six years equals $0.5\text{h} = 3\text{h} / 6\text{yrs}$. This means they claim to have played an average 3 hours on each day at the age of four. Although this is technically not impossible, it seems to be a bold claim. The more probable explanation is that the question was not properly explained to the participants, thus invalidating the entire data set (some might have misunderstood, while others correctly ). This underlines the requirement for an experimenter to identify difficult questions in pilot studies, and consequentially to either meticulously explain those questionnaire items to participants, or ask simpler questions.

### The Last Age Bracket

In addition to containing answers to possibly misunderstood questions, such data sets may contain a second pitfall, and that is that the last age bracket someone fills in has usually not ended yet. So for the age bracket participants are in at the time of the study, subjects are usually asked to provide the average daily practice hours during the years in this bracket so far. For the analysis this must be taken into account, i.e. these brackets' average times must be recalculated to not under-estimate practice times of the age brackets every participant was in at the time of the study.

***

`r figr("IndivPracticeTime", type = TABREF)`. *Artificial practice times data of a 26-year-old participant. The first row shows the age brackets for which the participants were asked to retrospectively provide estimates of their mean daily practice time (in hours). To underscore the unequal durations of brackets in this hypothetical study, the row* Age, in yrs *lists the age the participants were in the corresponding age brackets. The row* Played an instrument *has a plus sign (+) for each age in which the participant played the instrument.* Estimated daily practice hours *lists the times provided by the participant.* Multiplier¹ *is simply the bracket duration (in years, not accounting for leap years; see also note below table).* Corrected multiplier² *shortens the duration of a subject's last bracket to the number of years this person actually lived through this bracket.* Corrected multiplier³ *additionally takes into account the date-of-birth of a person and corrects the bracket durations for leap years. The rows containing * practice hours per bracket 

```{r IndivPracticeTime, anchor=TABREF}
## This chunk intentionally empty
```

~~~
Age bracket          [13   -   16]   [17  -   20]   [21     -    25]   [26    -    30]
___________________________________|______________|__________________|________________
Age, in yrs           13 14 15 16  |  17 18 19 20 |  21 22 23 24 25  |  26 27 28 29 30
                                   |              |                  |
Played an              +  +  +  +  |   +  +  +  + |   +  +  +  +  +  |   +
instrument                         |              |                  |
                                   |              |                  |
Estimated daily            2       |      3       |         6        |        8
practice hours                     |              |                  |
                                   |              |                  |
Multiplier¹             4 x 365    |   4 x 365    |      5 x 365     |     5 x 365
(bracket duration, days)           |              |                  |
                                   |              |                  |
Corrected             4 x 365.25   |  4 x 365.25  |     5 x 365.25   |    1 x 365.25
multiplier (days)²                 |              |                  |
                                   |              |                  |
Corrected             (1 x 366) +  | (1 x 366) +  |    (2 x 366) +   |       158
multiplier (days)³    (3 x 365)    | (3 x 365)    |    (3 x 365)     |
                                   |              |                  |
Practice                2920       |    4380      |     10950        |     14600
hours per bracket¹                 |              |                  |
                                   |              |                  |
Corrected practice      2922       |    4383      |     10957.5      |      2922
hours per bracket²                 |              |                  |
                                   |              |                  |
Corrected practice      1827       |  **X**       |     **X**        |      1264
hours per bracket³                 |              |                  |
______________________________________________________________________________________
~~~

Should we choose to ignore leap years, we calculate with uncorrected multipliers¹:

```{r echo=TRUE}
(2 * 3 * 365) + (3 * 3 * 365) + (6 * 4 * 365) + (8 * 4 * 365)
```

and obtain 25915 cumulative practice hours for subject A.

Since there is a leap year every fourth year, we can do better and hope that, on average, this pans out:

```{r echo=TRUE}
(2 * 3 * 365.25) + (3 * 3 * 365.25) + (6 * 4 * 365.25) + (8 * 4 * 365.25)
```

One must be aware though that individual cumulative practice hours calculated this way would *not* reflect a person's 'true' sum of hours spent at the instrument--even if they all had remembered their practice times for each bracket correctly. If the sample size and the sampling duration were large enough one could assume that the group average would be truly representative of the sample (again assuming only correct answers were given).

With the corrected multiplier² for the last bracket we calculate

```{r echo=TRUE}
(2 * 3 * 365.25) + (3 * 3 * 365.25) + (6 * 4 * 365.25) + (8 * 1 * 365.25)
```

which results in 17166.75 cumulative practice hours for A. This is a difference of 8766 hours, equivalent to one year! The relative difference is (25915 - 17166.75) / 25915 $\approx$ `r round((25915 - 17155) / 25915, 2)`, or `r -round((1 - (25915 - 17155) / 25915) * 100)`%. 

Do this for the data set:

```{r, echo=TRUE}
## Add bracket multipliers:
## Either find the age range column indexes by matching a unique pattern, 
## e.g. "^[0-9]{1,2}-[0-9]{1,2}$":
age_range_idx <- grep("[0-9]{1,2}-[0-9]{1,2}", 
                      names(practicetime))
## Or, equivalently:
# age_range_idx <- grep("[0-9]{1,2}-[0-9]{1,2}",
#                       names(practicetime))
## Or provide the column indices explicitly:
# age_range_idx <- c(4:10) 
## The multipliers reflect the duration of each bracket in
## each subject:
multipliers <- bracket_multipliers(practicetime,
                                   age_range_idx,
                                   sep = "-")
```

```{r, echo=TRUE}
# bracket hours:
practicetime_brackethours <- bracket_hours(practicetime, 
                                           cols = age_range_idx, 
                                           bracket_mult = multipliers)
```

```{r}
old_opt <- options(knitr.kable.NA = "-")
kable(rbind(head(practicetime_brackethours),
            tail(practicetime_brackethours)), 
      row.names = FALSE)
options(knitr.kable.NA = old_opt)
```

```{r}
pt_bh_summary <- pivot_longer(practicetime_brackethours, 
                              cols = starts_with("Hours_"), 
                              names_to = "Bracket", 
                              values_to = "Hours_per_bracket")
pt_bh_summary <- mutate(pt_bh_summary,
                        Bracket = factor(Bracket,
                                         ordered = TRUE,
                                         levels = unique(Bracket),
                                         labels = unique(Bracket)))
ggplot(pt_bh_summary, aes(Bracket, Hours_per_bracket, 
                          group = ID, 
                          color = ID)) +
  geom_point(na.rm = TRUE) +
  geom_line(na.rm = TRUE) +
  theme(legend.position = "none")
```

These calculations assume that the hypothetical subject A played the entire year when they were 26 years old for an average eight daily hours. If we additionally take into account that leap years last an additional day, we need to include the date-of-birth and the time the subject took part in the investigation. By doing so, we can account for leap years *and* adjust the last bracket's multiplier to the day. And that is what we are going to do next.

### Unequal Bracket Durations

It is tempting to collapse age ranges less relevant for the calculation of the cumulative practice time to brackets of longer duration. For instance, time spent at the instrument during very early age does not considerably contribute to the target number because very young children usually do not spend large amounts of time **rephrase**doing the same**/rephrase**. While collapsing is generally no problem, it should be noted that subjects need to be instructed properly to ensure they are aware of unequal bracket duration.

## A More Sophisticated Approach

In the naive approach outlined above it was assumed that subjects 

```{r, echo=TRUE}
## add age and days since last birthday:
ptime_sophist <- mutate(practicetime,
                        Age = days_lived(DOB, 
                                         Date),
                        DaysSinceLastBday = days_since_bday(DOB, 
                                                            Date))
```

First, we need to find the column index of the last age bracket in each subject:

```{r, echo=TRUE}
## Find last age bracket column for each subject:
last_bracket_idx <- col_lastentry(ptime_sophist, 
                                  cols = "\\d{1,2}-\\d{1,2}")
## Length of each participant's last age bracket:
durations_last_brackets <- names_to_durations(names(ptime_sophist)[last_bracket_idx])
```


```{r, echo=TRUE}
## Because of leap seconds, duration spent in last bracket needs to be 
## calculated in secs (achieved by lubridate::as.duration()) to be unambiguous:
duration_spent_in_bracket <- as.duration(years(durations_last_brackets) - 
                                           ptime_sophist$DaysSinceLastBday)
as.numeric(duration_spent_in_bracket, "years")
```

## References

